<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
"http://mybatis.org/dtd/mybatis-3-mapper.dtd" >

<mapper namespace="com.team3.prj.dao.StayListDAO">
	<select id="StayListAll" resultType="com.team3.prj.vo.StayListVO">
	SELECT m.region, m.title, m.addr,
		   d.weekday_price, d.weekend_price
	FROM(
		SELECT 
		FROM room_mst
		<where>
		(<if test='ishotel != null and !"".equals(ishotel)'>
		OR type_of_acco = #{ishotel} <!-- 공통코드 class3 참조 -->
        </if> 
		<if test='ismotel != null and !"".equals(ismotel)'>
		OR type_of_acco = #{ismotel} <!-- 공통코드 class3 참조 -->
        </if> 
		<if test='ispension != null and !"".equals(ispension)'>
		OR type_of_acco = #{ispension} <!-- 공통코드 class3 참조 -->
        </if> 
		<if test='isglamping != null and !"".equals(isglamping)'>
		OR type_of_acco = #{isglamping} <!-- 공통코드 class3 참조 -->
        </if> 
		<if test='isguestHouse != null and !"".equals(isguestHouse)'>
		OR type_of_acco = #{isguestHouse} <!-- 공통코드 class3 참조 -->
        </if> 
		<if test='isresort != null and !"".equals(isresort)'>
		OR type_of_acco = #{isresort} <!-- 공통코드 class3 참조 -->
        </if>)
      
        <if test='keyword!= null and !"".equals(keyword)'>
		AND( region LIKE '%'|| #{keyword} ||'%'
		OR title LIKE '%'|| #{keyword} ||'%'
		OR addr LIKE '%'|| #{keyword} ||'%'
		)
        </if> 
       
        </where>
	)
	INNER  JOIN room_dtl d
	ON     m.id     = d.mst_id
	
<!--  	AND    m.yyyyyy = d.yyyyyy -->
<!--     AND    m.xxxx   = d.xxxx -->

	</select>
	<select id ="search" resultType="com.team3.prj.vo.StayListSearchVO">
	SELECT
	FROM (SELECT * FROM room_mst WHERE...)romm_mst m
	INNER JOIN(
		SELECT * 
		FROM room_dtl
		WHERE (weekday_price between #{minweekdayPrice} and #{maxweekdayPrice}
		OR     weekend_price between #{minweekendPrice} and #{maxweekendPrice})
		AND    num_of_guests = #{numofguests}
		) room_dtl d
	ON M.ID = D.MST_ID
	
	
	
	
	<!-- <if test='class1 != null and !"".equals(class1)'>
         AND class1 = #{class1}
         </if> 
    -->
	<!-- (@인원수 = '' OR B.NUM_OF_GUESTS = @인원수)
	AND ((@최저가격 = '' OR (B.WEEKDAY_PRICE <![CDATA[ > ]]> @최저가격 AND B.WEEKDAY_PRICE <![CDATA[ > ]]> @최저가격)
	AND ((@최고가격 = '' OR (B.WEEKEND_PRICE <![CDATA[ < ]]> @최고가격 AND B.WEEKEND_PRICE <![CDATA[ < ]]> @최고가격)  -->
</select>
</mapper>