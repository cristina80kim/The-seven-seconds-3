<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
"http://mybatis.org/dtd/mybatis-3-mapper.dtd" >

<mapper namespace="com.team3.prj.dao.StayListDAO">
  <select id="StayListAll" resultType="com.team3.prj.vo.StayListVO">
  </select>

  <select id ="search" resultType="com.team3.prj.vo.StayListSearchResultVO">
  
    SELECT m.*, d.*, c.name as type_of_acco_name
    FROM ( SELECT id, region, title, addr, pic1_uuid, type_of_acco   
           FROM   room_mst
            <where>
              <if test='(isHotel != null and !"".equals(isHotel)) 
                or (isMotel != null and !"".equals(isMotel)) 
                or (isPension != null and !"".equals(isPension)) 
                or (isGlamping != null and !"".equals(isGlamping)) 
                or (isGuestHouse != null and !"".equals(isGuestHouse)) 
                or (isResort != null and !"".equals(isResort))'>
                (1 = 1
              </if>
              
              <if test='isHotel != null and !"".equals(isHotel)'>
                OR type_of_acco = #{isHotel} <!-- 공통코드 class3 참조 -->
              </if> 
              <if test='isMotel != null and !"".equals(isMotel)'>
                OR type_of_acco = #{isMotel} <!-- 공통코드 class3 참조 -->
              </if> 
              <if test='isPension != null and !"".equals(isPension)'>
                OR type_of_acco = #{isPension} <!-- 공통코드 class3 참조 -->
              </if> 
              <if test='isGlamping != null and !"".equals(isGlamping)'>
                OR type_of_acco = #{isGlamping} <!-- 공통코드 class3 참조 -->
              </if> 
              <if test='isGuestHouse != null and !"".equals(isGuestHouse)'>
                OR type_of_acco = #{isGuestHouse} <!-- 공통코드 class3 참조 -->
              </if>
              <if test='isResort != null and !"".equals(isResort)'>
                OR type_of_acco = #{isResort} <!-- 공통코드 class3 참조 -->
              </if>
            
              <if test='(isHotel != null and !"".equals(isHotel)) 
                or (isMotel != null and !"".equals(isMotel)) 
                or (isPension != null and !"".equals(isPension)) 
                or (isGlamping != null and !"".equals(isGlamping)) 
                or (isGuestHouse != null and !"".equals(isGuestHouse)) 
                or (isResort != null and !"".equals(isResort))'>              
                )
              </if>
            
              <if test='keyword!= null and !"".equals(keyword)'>
                AND (region LIKE '%'|| #{keyword} ||'%'
                  OR title  LIKE '%'|| #{keyword} ||'%'
                  OR addr   LIKE '%'|| #{keyword} ||'%'
                )
              </if> 
            </where>
    ) m
    INNER JOIN code c
    ON    c.class1 = 'ROOM' 
    AND   c.class2 = 'TYPE_OF_ACCO'
    AND   c.class3 = m.type_of_acco
    INNER JOIN (
      SELECT id, mst_id, weekday_price, weekend_price
      FROM   room_dtl
      WHERE (weekday_price BETWEEN #{minPrice} AND #{maxPrice}
      OR     weekend_price BETWEEN #{minPrice} AND #{maxPrice})
      AND    num_of_guests = #S{numOfGuests}
      ) d
    ON    m.id = d.mst_id
  </select>
</mapper>